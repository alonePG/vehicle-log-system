<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏ñ‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <audio id="successSound" preload="auto">
    <source src="https://media.vocaroo.com/mp3/16O6YCTv88bJ" type="audio/mp3" />
  </audio>
  <style>
    body {
      margin: 0;
      padding: 0;
      background-color: #e9ecef;
      font-family: 'Segoe UI', Tahoma, sans-serif;
    }
    .app-wrapper {
      width: 100%;
      max-width: 420px;
      margin: 0 auto;
    }
    .form-card {
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      background-color: white;
      padding: 1.5rem 1rem;
      border-radius: 1.25rem 1.25rem 0 0;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    }
    .logo {
      display: block;
      margin: 0 auto 1rem auto;
      max-width: 120px;
      height: auto;
    }
    h2 {
      font-size: 1.4rem;
      margin-bottom: 1.5rem;
      color: #333;
    }
    .form-label {
      font-weight: 600;
      font-size: 0.95rem;
      margin-bottom: 0.25rem;
      color: #444;
    }
    .form-control,
    .form-select {
      padding: 0.75rem;
      font-size: 1rem;
      border-radius: 0.6rem;
      margin-bottom: 1rem;
    }
    .btn-success {
      padding: 0.85rem;
      font-size: 1rem;
      border-radius: 0.75rem;
      background-color: #28a745;
      border: none;
    }
    #statusMsg {
      margin-top: 1.5rem;
      font-size: 0.95rem;
    }
  </style>
</head>
<body>
  <div class="app-wrapper">
    <div class="form-card text-center">
      <img src="https://i.imgur.com/QEBYa5H.png" class="logo" alt="‡πÇ‡∏•‡πÇ‡∏Å‡πâ‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô" />
      <h2>‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤-‡∏≠‡∏≠‡∏Å‡∏Ç‡∏≠‡∏á‡∏£‡∏ñ‡∏¢‡∏ô‡∏ï‡πå</h2>
      <form id="entryForm">
        <label for="plate" class="form-label">‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏£‡∏ñ</label>
        <input type="text" class="form-control" id="plate" required />

        <label for="house" class="form-label">‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà / ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
        <input type="text" class="form-control" id="house" required />

        <label for="purpose" class="form-label">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå</label>
        <select class="form-select" id="purpose" required>
          <option value="‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á">‡∏™‡πà‡∏á‡∏Ç‡∏≠‡∏á</option>
          <option value="‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö">‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏ö</option>
          <option value="‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á">‡∏£‡∏±‡∏ö‡∏Ç‡∏≠‡∏á</option>
          <option value="‡∏≠‡∏∑‡πà‡∏ô ‡πÜ">‡∏≠‡∏∑‡πà‡∏ô ‡πÜ</option>
        </select>
        <input type="text" class="form-control" id="otherPurpose" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)" style="display:none;" />

        <label for="note" class="form-label">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡πÑ‡∏°‡πà‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö)</label>
        <textarea class="form-control" id="note" rows="2"></textarea>

        <label for="idCardImg" class="form-label">‡∏ñ‡πà‡∏≤‡∏¢‡∏†‡∏≤‡∏û‡∏ö‡∏±‡∏ï‡∏£‡∏ú‡∏π‡πâ‡∏°‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
        <input type="file" class="form-control" id="idCardImg" accept="image/*" capture="environment" required />

        <button type="submit" class="btn btn-success w-100">üì• ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
      </form>
      <div id="statusMsg" class="mt-3"></div>
    </div>
  </div>

<script>
  const form = document.getElementById("entryForm");
  const purpose = document.getElementById("purpose");
  const otherPurpose = document.getElementById("otherPurpose");
  const statusMsg = document.getElementById("statusMsg");
  const successSound = document.getElementById("successSound");

  purpose.addEventListener("change", () => {
    otherPurpose.style.display = purpose.value === "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" ? "block" : "none";
  });

  form.addEventListener("submit", async (e) => {
    e.preventDefault();
    const plate = document.getElementById("plate").value.trim();
    const house = document.getElementById("house").value.trim();
    const purposeVal = purpose.value === "‡∏≠‡∏∑‡πà‡∏ô ‡πÜ" ? otherPurpose.value.trim() : purpose.value;
    const note = document.getElementById("note").value.trim();
    const fileInput = document.getElementById("idCardImg");

    if (!plate || !house || !purposeVal) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö‡∏ñ‡πâ‡∏ß‡∏ô");
    if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏†‡∏≤‡∏û‡∏ö‡∏±‡∏ï‡∏£");

    const file = fileInput.files[0];
    const reader = new FileReader();
    reader.onload = async function () {
      const img = new Image();
      img.src = reader.result;
      img.onload = async function () {
        const canvas = document.createElement("canvas");
        const ctx = canvas.getContext("2d");
        const MAX_WIDTH = 800;
        const scale = MAX_WIDTH / img.width;
        canvas.width = MAX_WIDTH;
        canvas.height = img.height * scale;
        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
        ctx.font = `${Math.floor(canvas.width / 25)}px sans-serif`;
        ctx.fillStyle = "rgba(255, 0, 0, 0.5)";
        ctx.fillText("‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÉ‡∏ä‡πâ‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏°‡∏π‡πà‡∏ö‡πâ‡∏≤‡∏ô‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô", 20, canvas.height - 40);

        const base64Image = canvas.toDataURL("image/jpeg", 0.85).split(",")[1];
        const data = new URLSearchParams();
        data.append("plate", plate);
        data.append("house", house);
        data.append("purpose", purposeVal);
        data.append("note", note);
        data.append("filename", "photo.jpg");
        data.append("imageformat", "jpeg");
        data.append("file", base64Image);

        statusMsg.innerHTML = `<div class="alert alert-info">üì§ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>`;

        try {
          const res = await fetch("https://script.google.com/macros/s/AKfycbz65_-A329UbJHkRcotUC16USTZCaYtAcl5QlT8k2m33EDe7sDdme5sOV7jjvTr8ZpG/exec", {
            method: "POST",
            headers: { "Content-Type": "application/x-www-form-urlencoded" },
            body: data.toString()
          });
          const result = await res.text();
          const isError = result.startsWith("üö´") || result.startsWith("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î");
          statusMsg.innerHTML = `<div class='alert alert-${isError ? "danger" : "success"}'>${result}</div>`;

          if (!isError) {
            successSound.play().catch(() => {});
            form.reset();
            otherPurpose.style.display = "none";
          }
        } catch (err) {
          statusMsg.innerHTML = `<div class='alert alert-danger'>‚ùå ‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${err}</div>`;
        }
      };
    };
    reader.readAsDataURL(file);
  });
</script>
</body>
</html>